/*
 *
 *  SPCOM-0.1.1.min.js
 *  By Josh Rouwhorst
 *
 */
SPCOM=(function(){var q="http://joshrouwhorst.com/sp/";var x=q+"css/SPCOM-0.1.1.min.css";var b=new Array();var u=$().SPCOMServices.SPGetCurrentSite();function o(E,D,C){if(D===undefined){D=25}if(C===undefined){C="..."}if(E.length>(D-C.length)){return E.substring(0,(D-C.length))+C}else{return E}}var h=(function(){var G;var C;var H;function E(){if(event===undefined){event=window.event}if(event.currentTarget){childElem=event.currentTarget}else{if(event.srcElement){childElem=event.srcElement}}H=childElem.parentNode.parentNode.parentNode.parentNode;if(H.style.left){var L=parseInt(H.style.left)}else{if(H.style.right){var L=parseInt(H.style.right)}}if(H.style.top){var K=parseInt(H.style.top)}else{if(H.style.bottom){var K=parseInt(H.style.bottom)}}if(H.style.left){G=event.clientX-L}else{if(H.style.right){var J=(document.documentElement.clientWidth-event.clientX);G=J-L}}if(H.style.top){C=event.clientY-K}else{if(H.style.bottom){var I=(document.documentElement.clientHeight-event.clientY);C=I-K}}if(document.addEventListener){document.addEventListener("mousemove",D,true);document.addEventListener("mouseup",F,true)}else{if(document.attachEvent){document.attachEvent("onmousemove",D);document.attachEvent("onmouseup",F)}}}function D(){if(event===undefined){event=window.event}if(H.style.left){H.style.left=(event.clientX-G)+"px"}else{if(H.style.right){var I=(document.documentElement.clientWidth-event.clientX);H.style.right=(I-G)+"px"}}if(H.style.top){H.style.top=(event.clientY-C)+"px"}else{if(H.style.bottom){var J=(document.documentElement.clientWidth-event.clientX);H.style.top=(J-C)+"px"}}}function F(){if(event===undefined){event=window.event}if(document.removeEventListener){document.removeEventListener("mouseup",F,true);document.removeEventListener("mousemove",D,true)}else{if(document.detachEvent){document.detachEvent("onmouseup",F);document.detachEvent("onmousemove",D)}}}return{grab:E}}());function a(C){if(C!==undefined){return C.replace(/[^a-zA-Z0-9]+/g,"")}else{return""}}function B(){$(event.srcElement).addClass("SPCOM-shaded")}function y(){$(event.srcElement).removeClass("SPCOM-shaded")}var v=(function(){function G(){var I="<div class='SPCOM-listInfo SPCOMProp' id='SPCOMlistInfo'><table class='SPCOM-listInfo-bar'><tr><td class='SPCOM-clickDrag' onmousedown='SPCOM.clickDrag.grab()'></td><td onclick='SPCOM.info.hide()' class='SPCOM-listInfo-exit' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>X</td></tr></table><table class='SPCOM-listInfo-topTable'><tr><td class='SPCOM-listInfo-title'></td></tr><tr><td class='SPCOM-listInfo-desc'></td></tr></table><table><tr><td class='SPCOM-listInfo-sub1'></td><td class='SPCOM-listInfo-sub2'></td><td class='SPCOM-listInfo-sub3'></td></tr></table><table class='SPCOM-listInfo-status'><tr><td></td></tr></table><table class='SPCOM-listInfo-catTable'><tr valign='top'><td><div class='SPCOM-listInfo-menu1'></div></td><td><div class='SPCOM-listInfo-menu2'></div></td><td><div class='SPCOM-listInfo-menu3'></div></td></tr></table></div>";$("body").append(I)}function D(I,J){$(".SPCOM-listInfo-status td").html(I);$(".SPCOM-listInfo-status").show();if(J!==undefined&&!isNaN(parseInt(J))){setTimeout(function(){$(".SPCOM-listInfo-status").hide()},J)}}function F(){$("#SPCOMlistInfo").hide()}function C(){xWide=document.body.clientWidth;$("#SPCOMlistInfo").css({top:"100px",left:((xWide/2)-425)+"px"});$("#SPCOMlistInfo").show()}function H(J,I){if(J.title!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-title").html(J.title)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-title").html("")}}if(J.desc!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-desc").html(J.desc)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-desc").html("")}}if(J.sub1!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-sub1").html(J.sub1)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-sub1").html("")}}if(J.sub2!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-sub2").html(J.sub2)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-sub2").html("")}}if(J.menu1!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-menu1").html(J.menu1)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-menu1").html("")}}if(J.menu2!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-menu2").html(J.menu2)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-menu2").html("")}}if(J.menu3!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-menu3").html(J.menu3)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-menu3").html("")}}}function E(I){switch(I){case"title":return $("#SPCOMlistInfo .SPCOM-listInfo-title").html();case"desc":return $("#SPCOMlistInfo .SPCOM-listInfo-desc").html();case"sub1":return $("#SPCOMlistInfo .SPCOM-listInfo-sub1").html();case"sub2":return $("#SPCOMlistInfo .SPCOM-listInfo-sub2").html();case"menu1":return $("#SPCOMlistInfo .SPCOM-listInfo-menu1").html();case"menu2":return $("#SPCOMlistInfo .SPCOM-listInfo-menu2").html();case"menu3":return $("#SPCOMlistInfo .SPCOM-listInfo-menu3").html();default:return false}}return{status:D,show:C,hide:F,set:H,get:E,build:G}}());var c=function(G){var C=function(I){this.selectField=function(){var K=(H.numLines==="")?"":"<tr><td>Number of Lines: "+H.numLines+"</td></tr>";var N=(H.format==="")?"":"<tr><td>Format: "+H.format+"</td></tr>";var J=(H.maxLength==="")?"":"<tr><td>Max Length: "+H.maxLength+"</td></tr>";var O="";if(H.type==="Choice"){O="<tr><td>Choices: <select>";for(var M=0;M<H.choices.options.length;M++){O+="<option>"+H.choices.options[M]+"</option>"}O+="</select></td></tr>";if(H.choices.defaultOpt!==""){O+="<tr><td>Default Choice: "+H.choices.defaultOpt+"</td></tr>"}}var L="<table><tr><td><a href='"+H.settings+"'>Settings</a></td></tr><tr><td class='SPCOM-listInfo-headers'>Names</td></tr><tr><td>Display Name:</td></tr><tr><td><input type='text' style='width: 100%;' value='"+H.displayName+"' /></td></tr><tr><td>Attribute Name:</td></tr><tr><td><input type='text' style='width: 100%;' value='ows_"+H.name+"' /></td></tr><tr><td>M1SP Name:</td></tr><tr><td><input type='text' style='width: 100%;' value='"+d(H.displayName)+"' /></td></tr><tr><td class='SPCOM-listInfo-headers'>Info</td></tr><tr><td>Type: "+H.type+"</td></tr>"+J+N+O+"<tr><td>Required: "+H.required+"</td></tr>"+K+"<tr><td>Sortable: "+H.sortable+"</td></tr><tr><td>Read Only: "+H.readOnly+"</td></tr><tr><td>Hidden: "+H.hidden+"</td></tr></table>";v.set({menu3:L})};this.displayName="";this.staticName="";this.name="";this.required=false;this.numLines="";this.sortable=false;this.format="";this.maxLength="";this.choices="";if($(I).attr("DisplayName")!==undefined){this.displayName=$(I).attr("DisplayName")}if($(I).attr("StaticName")!==undefined){this.staticName=$(I).attr("StaticName")}if($(I).attr("Name")!==undefined){this.name=$(I).attr("Name")}if($(I).attr("Required")!==undefined&&$(I).attr("Required")==="TRUE"){this.required=true}if($(I).attr("NumLines")!==undefined){this.numLines=$(I).attr("NumLines")}if($(I).attr("Sortable")!==undefined&&$(I).attr("Sortable")==="TRUE"){this.sortable=true}if($(I).attr("Format")!==undefined){this.format=$(I).attr("Format")}if($(I).attr("MaxLength")!==undefined){this.maxLength=$(I).attr("MaxLength")}this.readOnly=$(I).attr("ReadOnly")==="TRUE"?true:false;this.hidden=$(I).attr("Hidden")==="TRUE"?true:false;this.id=$(I).attr("ID");this.safeId=a(this.id);this.type=$(I).attr("Type");this.settings=m.rootPath+"/_layouts/FldEdit.aspx?List="+E.id+"&Field="+this.staticName;var H=this;if(this.type==="Choice"){this.choices={defaultOpt:"",options:new Array()};$(I).find("Default").each(function(){H.choices.defaultOpt=this.text});$(I).find("CHOICE").each(function(){H.choices.options.push(this.text)})}this.html="<tr onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='SPCOM.site.lists[\""+E.safeId+'"].fields["'+a(this.id)+"\"].selectField()'><td>"+this.displayName+"</td></tr>";return this};this.moreInfo=function(){v.set({title:E.title,desc:E.desc,sub1:"Item Count: "+E.itemCount,sub2:"<a href='"+E.settings+"'>Settings</a>",menu1:"<table><tr><td onclick='SPCOM.site.lists[\""+E.safeId+"\"].selectCommands()' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Commands</td></tr><tr><td onclick='SPCOM.site.lists[\""+E.safeId+"\"].selectFields()' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Fields</td></tr></table>"},true);E.selectCommands();v.show();F()};this.selectCommands=function(){var I="<table>";for(var H=0;H<E.commands.length;H++){I+="<tr><td onclick='SPCOM.site.lists[\""+E.safeId+'"].commands['+H+"].select()' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>"+E.commands[H].name+"</td></tr>"}I+="</table>";v.set({menu2:I,menu3:""})};this.selectFields=function(){var H="";for(var I in E.fields){if(I!==undefined&&I!==""){if(E.fields[I].displayName!==""&&E.fields[I].staticName!==""&&!E.fields[I].readOnly&&!E.fields[I].hidden&&E.fields[I].displayName!=="Attachments"){H+=E.fields[I].html}}}v.set({menu2:"<table>"+H+"</table>",menu3:""})};this.selectViews=function(){};this.refresh=function(){if($(v.get("title")).html()===E.title){v.set({title:"<a href='"+E.settings+"'>"+E.title+"</a>",desc:E.desc,sub1:"Item Count: "+E.itemCount,sub2:"<a href='"+E.addItem+"'>Add Item</a>"})}};function D(){if(E.type==="Document Libraries"){$().SPCOMServices({operation:"GetListItems",listName:E.title,CAMLQuery:"<Query><Where><Neq><FieldRef Name='Title' /><Value Type='Text'></Value></Neq></Where></Query>",CAMLQueryOptions:"<QueryOptions><ViewAttributes Scope='Recursive' /></QueryOptions>",async:true,completefunc:function(H,I){$(H.responseXML).find("[nodeName='z:row']").each(function(){if($(this).attr("ows_LinkFilename").indexOf(".aspx")>-1){if(m.pages===0){$("#SPCOMitemPages > tbody").html("")}m.pages++;$("#SPCOMitemPages > tbody").append("<tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='window.location=\"/"+$(this).attr("ows_FileRef").split(";#")[1]+"\"'>"+o($(this).attr("ows_LinkFilename"))+"</td></tr>")}})}})}}function F(){$().SPCOMServices({operation:"GetList",listName:E.title,async:true,completefunc:function(I,H){$(I.responseXML).find("Field").each(function(){if(a($(this).attr("ID"))!==""&&a($(this).attr("ID"))!==undefined){E.fields[a($(this).attr("ID"))]=new C(this)}})}})}this.type="";switch($(G).attr("ServerTemplate")){case ("100"):this.type="Lists";break;case ("101"):this.type="Document Libraries";break;case ("109"):this.type="Picture Libraries";break;case ("108"):this.type="Discussion Boards";break;case ("102"):this.type="Surveys";break}this.title=$(G).attr("Title");this.desc=$(G).attr("Description");this.itemCount=$(G).attr("ItemCount");this.url=$(G).attr("DefaultViewUrl");this.id=$(G).attr("ID");this.safeId=a(this.id);this.name=$(G).attr("Name");this.excel=this.url+"?ShowInGrid=True&View=";this.fields=new Array();this.settings=u+"/_layouts/listedit.aspx?List="+encodeURIComponent(this.name);this.addColumn=u+"/_layouts/fldNew.aspx?List="+encodeURIComponent(this.name);this.addItem=u+"/Lists/"+encodeURIComponent(this.title)+"/NewForm.aspx";this.commands=new Array();var E=this;if(this.type==="Document Libraries"){D()}this.commands[2]=(function(){var I="Add Column";function H(){window.location=E.addColumn}return{name:I,select:H}}());this.commands[1]=(function(){var I="Add Item";function H(){window.location=E.addItem}return{name:I,select:H}}());this.commands[0]=(function(){var I="Delete Items";var K=(function(){var R;var U='SPCOM.site.lists["'+E.safeId+'"].commands[0]';var W="<table></table>";var Q="<tr><td class='SPCOM-listInfo-headers'>Delete Items</td></tr>";var O="<tr><td><input id='SPCOMdelAll' type='checkbox' onclick='"+U+".menu.delAll(false)' checked /> Delete All Items?</td></tr>";var P="<tr><td><input id='SPCOMdelAll' type='checkbox' onclick='"+U+".menu.delAll(true)' /> Delete All Items?</td></tr>";var N="<tr><td><select class='SPCOM-deleteItem-andOr'><option>And</option><option>Or</option></select></td></tr>";var M="<div></div>";var T="<tr><td style='text-align: center;'><input onclick='"+U+".run()' type='button' value='Run' /></td></tr>";function L(){var X="";for(var Y in E.fields){if(Y!==undefined&&Y!==""&&((!E.fields[Y].readOnly&&!E.fields[Y].hidden)||((E.fields[Y].displayName==="Created"&&E.fields[Y].type==="DateTime")||(E.fields[Y].displayName==="Modified"&&E.fields[Y].type==="DateTime")||E.fields[Y].displayName==="Created By"||E.fields[Y].displayName==="Modified By"||E.fields[Y].displayName==="ID"))&&E.fields[Y].displayName!=="Attachments"){X+="<option value='"+Y+"'>"+E.fields[Y].displayName+"</option>"}}return"<tr><td><select class='SPCOM-deleteItem-field'>"+X+"</select></td></tr><tr><td><select class='SPCOM-deleteItem-operator'><option value='Eq'>Is Equal To</option><option value='Neq'>Is Not Equal To</option><option value='Gt'>Is Greater Than</option><option value='Lt'>Is Less Than</option><option value='Geq'>Is Greater Than or Equal To</option><option value='Leq'>Is Less Than or Equal To</option><option value='BeginsWith'>Begins With</option><option value='Contains'>Contains</option></select></td></tr><tr><td><input type='text' class='SPCOM-deleteItem-value' /></td></tr>"}function S(X){if(X){var Z=$(W).append(Q).append(O).append(T);var Y=$(M).append(Z);v.set({menu3:$(Y).html()})}else{var Z=$(W).append(Q).append(P).append(L()).append(T);var Y=$(M).append(Z);v.set({menu3:$(Y).html()})}}function V(){var Y=$(W).append(Q).append(O).append(T);var X=$(M).append(Y);v.set({menu3:$(X).html()})}return{delAll:S,init:V}}());function J(){if($("#SPCOMdelAll").attr("checked")){var L=confirm("Are you sure you want to delete ALL items from "+E.title+"?");if(L){v.status("Please Wait...");$().SPCOMServices({operation:"GetListItems",listName:E.title,CAMLQuery:"<Query><Where><Neq><FieldRef Name='Title' /><Value Type='Text'></Value></Neq></Where></Query>",async:true,completefunc:function(V,W){if(W&&V!==undefined){var S=new Array(),T;$(V.responseXML).find("[nodeName='z:row']").each(function(){row=new Array();$(this.attributes).each(function(){row[this.name]=$(this).val()});S[S.length]=row});T="<Batch OnError='Continue'>\n";for(var U=0;U<S.length;U++){T+="<Method ID='"+(U+1)+"' Cmd='Delete'>\n<Field Name='ID'>"+S[U].ows_ID+"</Field>\n</Method>\n"}T+="</Batch>";$().SPCOMServices({operation:"UpdateListItems",listName:E.title,updates:T,async:true,completefunc:function(X,Y){v.status(S.length+" items deleted.",5000);m.refreshList(E.title)}})}}})}}else{var M=$(".SPCOM-deleteItem-field").val();var O;for(var R in E.fields){if(R===M){O=E.fields[R];break}}var Q=$(".SPCOM-deleteItem-operator").val();var P=$(".SPCOM-deleteItem-value").val();var N="<Query><Where><"+Q+"><FieldRef Name='"+O.staticName+"' /><Value Type='"+O.type+"'>"+P+"</Value></"+Q+"></Where></Query>";$().SPCOMServices({operation:"GetListItems",listName:E.title,CAMLQuery:N,async:true,completefunc:function(W,X){if(X==="success"&&W!==undefined){v.status("Please Wait...");var S=new Array(),U;$(W.responseXML).find("[nodeName='z:row']").each(function(){row=new Array();$(this.attributes).each(function(){row[this.name]=$(this).val()});S[S.length]=row});var T=confirm("Are you sure you want to delete "+S.length+" items?");if(T){U="<Batch OnError='Continue'>\n";for(var V=0;V<S.length;V++){U+="<Method ID='"+(V+1)+"' Cmd='Delete'>\n<Field Name='ID'>"+S[V].ows_ID+"</Field>\n</Method>\n"}U+="</Batch>";$().SPCOMServices({operation:"UpdateListItems",listName:E.title,updates:U,async:true,completefunc:function(Y,Z){v.status(S.length+" items deleted.",5000);m.refreshList(E.title)}})}else{v.status("",0)}}}})}}function H(){K.init()}return{name:I,menu:K,run:J,select:H}}());return this};function e(C){return C.replace(/[^a-zA-Z0-9]+/g,"")}function i(D){if(D!="Nav"){var F=new Array();for(var G in m.lists){if(m.lists[G].type==D){F.push(m.lists[G])}}var E="<div class='SPCOM-menu-container'><table id='SPCOMitem"+a(D)+"' class='SPCOM-menu-item'><tbody>";var C="";$(F).each(function(){C+="<tr onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'><td onclick='SPCOM.site.lists[\""+a(this.id)+"\"].moreInfo()'>"+o(this.title)+"</td><td onclick='window.location=\""+this.url+"\";'>&gt;</td></tr>"});if(C===""){C="<tr><td colspan='2'>No Items Found</td></tr>"}E+=C+"</tbody></table></div>";return E}else{return"<div class='SPCOM-menu-container'><table id='SPCOMitemNav' class='SPCOM-menu-item'><tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='window.location=\""+m.allSite+"\"'>All Site Content</td></tr><tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='window.location=\""+m.main+"\"'>Default</td></tr><tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='window.location=\""+m.create+"\"'>Create</td></tr><tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='window.location=\""+m.settings+"\"'>Site Settings</td></tr><tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='window.location=\""+m.templates+"\"'>List Templates</td></tr></table></div>"}}function t(C){$("#SPCOMlistInfo"+C).show()}function l(C){$("#SPCOMlistInfo"+C).hide()}var A=["Nav","Pages","Lists","Document Libraries","Surveys"];function k(C){$("#SPCOMlistInfo"+C+" .SPCOM-listInfo-field-detail").show()}function p(C){$("#SPCOMlistInfo"+C+" .SPCOM-listInfo-field-detail").hide()}function f(){return $(location).attr("href")}function r(){$(".SPCOMProp").detach();$(".SPCOMProp").die();SPCOM=undefined}function d(C){while(C.indexOf(" ")>-1){C=C.replace(" ","")}return C}function n(C){C=e(C);$("#SPCOM-menu-"+C).addClass("SPCOM-shaded");$("#SPCOMitem"+C).parent().show()}function z(C){C=e(C);$("#SPCOM-menu-"+C).removeClass("SPCOM-shaded");$("#SPCOMitem"+C).parent().hide()}function g(){$("body").append("<link type='text/css' rel='stylesheet' href='"+x+"' />")}function w(){if($("#SPCOM-menu-row").html()!==undefined){$(A).each(function(){$("#SPCOM-menu-row").append("<td class='SPCOM-menu-td' id='SPCOM-menu-"+a(this)+"' onmouseout='SPCOM.hideMenu(\""+a(this)+"\")' onmouseover='SPCOM.showMenu(\""+a(this)+"\")'><div>"+this+"</div>"+i(this)+"</td>")})}else{setTimeout(w,100)}}function j(C){return{title:$(C).attr("Title"),itemCount:$(C).attr("ItemCount"),url:$(C).attr("DefaultViewUrl"),id:$(C).attr("ID"),name:$(C).attr("Name")}}function s(){$("body").prepend("<div id='SPCommander' class='SPCOMProp'><div><table id='SPCOM-menu'><tr id='SPCOM-menu-row'><td class='SPCOM-menu-td'><img src='http://joshrouwhorst.com/sp/imgs/spcom.png' /></td></tr></table></div>");w()}var m=(function(){var F,K,H,I,G,J=new Array(),C=0,D;$().SPCOMServices({operation:"GetListCollection",async:false,completefunc:function(M,L){$(M.responseXML).find("List").each(function(){var N=new c(this);J[N.safeId]=N})}});K=$().SPCOMServices.SPGetCurrentSite();H=K+"/_layouts/viewlsts.aspx";F=K+"/default.aspx";I=K+"/_catalogs/lt/Forms/AllItems.aspx";G=K+"/_layouts/Create.aspx";D=K+"/_layouts/settings.aspx";function E(L){$().SPCOMServices({operation:"GetList",listName:L,async:true,completefunc:function(N,M){$(N.responseXML).find("List").each(function(){var O=new c(this);J[O.safeId]=O;O.refresh()})}})}return{settings:D,pages:C,create:G,refreshList:E,templates:I,lists:J,rootPath:K,allSite:H,main:F}}());g();$().SPCOMServices.defaults.webUrl=$().SPCOMServices.SPGetCurrentSite();v.build();return{clickDrag:h,shade:B,unshade:y,info:v,site:m,showField:k,hideField:p,showListInfo:t,hideListInfo:l,buildBar:w,hideMenu:z,showMenu:n,exit:r,init:s}}());SPCOM.init();
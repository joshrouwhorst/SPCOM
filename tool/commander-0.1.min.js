/*
 *  SP Commander
 *  Copyright 2011, Josh Rouwhorst
 *
 */
var SPCOM;function SPCOM_JQUERY_WAIT(){try{if(jQuery===undefined||$().SPCOMServices===undefined){setTimeout(SPCOM_JQUERY_WAIT,100)}else{setTimeout(function(){SPCOM=(function(){var q="http://joshrouwhorst.com/sp/";var y=q+"css/spc.css";var c=new Array();var u=$().SPCOMServices.SPGetCurrentSite();function b(D){if(D!==undefined){return D.replace(/[^a-zA-Z0-9]+/g,"")}else{return""}}function C(){$(event.srcElement).addClass("SPCOM-shaded")}function z(){$(event.srcElement).removeClass("SPCOM-shaded")}function o(D,E){menuName=f(menuName);$("#SPCOM-menu-"+menuName).addClass("SPCOM-shaded");$("#SPCOMitem"+menuName).parent().show()}function x(D,E){}var v=(function(){function G(){var I="<div class='SPCOM-listInfo-container SPCOMProp' id='SPCOMlistInfo'><div class='SPCOM-listInfo'><table class='SPCOM-listInfo-topTable'><tr><td class='SPCOM-listInfo-title'></td><td class='SPCOM-listInfo-desc'></td><td onclick='SPCOM.info.hide()' class='SPCOM-listInfo-exit'>X</td></tr></table><table><tr><td class='SPCOM-listInfo-sub1'></td><td class='SPCOM-listInfo-sub2'></td></tr></table><table class='SPCOM-listInfo-catTable'><tr valign='top'><td><div class='SPCOM-listInfo-menu1'></div></td><td><div class='SPCOM-listInfo-menu2'></div></td><td><div class='SPCOM-listInfo-menu3'></div></td></tr></table></div></div>";$("body").append(I)}function F(){$("#SPCOMlistInfo").hide()}function D(){$("#SPCOMlistInfo").show()}function H(J,I){if(J.title!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-title").html(J.title)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-title").html("")}}if(J.desc!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-desc").html(J.desc)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-desc").html("")}}if(J.sub1!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-sub1").html(J.sub1)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-sub1").html("")}}if(J.sub2!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-sub2").html(J.sub2)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-sub2").html("")}}if(J.menu1!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-menu1").html(J.menu1)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-menu1").html("")}}if(J.menu2!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-menu2").html(J.menu2)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-menu2").html("")}}if(J.menu3!==undefined){$("#SPCOMlistInfo .SPCOM-listInfo-menu3").html(J.menu3)}else{if(I){$("#SPCOMlistInfo .SPCOM-listInfo-menu3").html("")}}}function E(I){switch(I){case"title":return $("#SPCOMlistInfo .SPCOM-listInfo-title").html();case"desc":return $("#SPCOMlistInfo .SPCOM-listInfo-desc").html();case"sub1":return $("#SPCOMlistInfo .SPCOM-listInfo-sub1").html();case"sub2":return $("#SPCOMlistInfo .SPCOM-listInfo-sub2").html();case"menu1":return $("#SPCOMlistInfo .SPCOM-listInfo-menu1").html();case"menu2":return $("#SPCOMlistInfo .SPCOM-listInfo-menu2").html();case"menu3":return $("#SPCOMlistInfo .SPCOM-listInfo-menu3").html();default:return false}}return{show:D,hide:F,set:H,build:G}}());var d=function(H){this.generateDeleteHtml=function(){var I="";for(var J in F.fields){if(J!==undefined&&J!==""){I+="<option value='"+J+"'>"+F.fields[J].displayName+"</option>"}}return"<table><tr><td class='SPCOM-listInfo-headers'>Delete Items</td></tr><tr><td><select class='SPCOM-deleteItem-field'>"+I+"</select></td></tr><tr><td><select class='SPCOM-deleteItem-operator'><option>Is Equal To</option><option>Is Not Equal To</option><option>Is Greater Than</option><option>Is Less Than</option><option>Is Greater Than or Equal To</option><option>Is Less Than or Equal To</option><option>Begins With</option><option>Contains</option></select></td></tr><tr><td><input type='text' class='SPCOM-deleteItem-value' /></td></tr></table>"};this.addDelStatement=function(){v.set({menu3:v.get("menu3")+F.generateDeleteHtml()})};this.selectDelete=function(){var I=F.generateDeleteHtml();I+="<table><tr><td onclick='SPCOM.site.lists[\""+F.safeId+"\"].addDelStatement()'>Add Statement</td></tr></table>";v.set({menu3:I})};var D=function(J){this.selectField=function(){var K="<table><tr><td class='SPCOM-listInfo-headers'>Names</td></tr><tr><td><input type='text' value='ows_"+I.staticName+"' /></td></tr><tr><td><input type='text' value='"+e(I.displayName)+"' /></td></tr></table>";v.set({menu3:K})};this.displayName="";this.staticName="";if($(J).attr("DisplayName")!==undefined){this.displayName=$(J).attr("DisplayName")}if($(J).attr("StaticName")!==undefined){this.staticName=$(J).attr("StaticName")}this.readOnly=$(J).attr("ReadOnly")==="TRUE"?true:false;this.hidden=$(J).attr("Hidden")==="TRUE"?true:false;this.id=$(J).attr("ID");this.safeId=b(this.id);this.html="<tr onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='SPCOM.site.lists[\""+F.safeId+'"].fields["'+b(this.id)+"\"].selectField()'><td>"+this.displayName+"</td></tr>";var I=this;return this};this.moreInfo=function(){v.set({title:"<a href='"+F.settings+"'>"+F.title+"</a>",desc:F.desc,sub1:"Item Count: "+F.itemCount,sub2:"<a href='"+F.excel+"'>Edit In Datasheet</a>",menu1:"<table><tr><td onclick='SPCOM.site.lists[\""+F.safeId+"\"].selectCommands()' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Commands</td></tr><tr><td onclick='SPCOM.site.lists[\""+F.safeId+"\"].selectFields()' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Fields</td></tr><tr><td onclick='SPCOM.site.lists[\""+F.safeId+"\"].selectViews()' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Views</td></tr></table>"},true);F.selectCommands();v.show()};this.selectCommands=function(){v.set({menu2:"<table><tr><td onclick='SPCOM.site.lists[\""+F.safeId+"\"].selectDelete()' onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Delete Items</td></tr><tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Add Item</td></tr><tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()'>Add Demo Data</td></tr></table>",menu3:""})};this.selectFields=function(){var I="";for(var J in F.fields){if(J!==undefined&&J!==""){if(F.fields[J].displayName!==""&&F.fields[J].staticName!==""&&!F.fields[J].readOnly&&!F.fields[J].hidden){I+=F.fields[J].html}}}v.set({menu2:"<table>"+I+"</table>",menu3:""})};this.selectViews=function(){};function E(){if(F.type==="Document Libraries"){$().SPCOMServices({operation:"GetListItems",listName:F.title,CAMLQuery:"<Query><Where><Neq><FieldRef Name='Title' /><Value Type='Text'></Value></Neq></Where></Query>",CAMLQueryOptions:"<QueryOptions><ViewAttributes Scope='Recursive' /></QueryOptions>",async:true,completefunc:function(I,J){$(I.responseXML).find("[nodeName='z:row']").each(function(){if($(this).attr("ows_LinkFilename").indexOf(".aspx")>-1){$("#SPCOMitemNav").append("<tr><td onmouseover='SPCOM.shade()' onmouseout='SPCOM.unshade()' onclick='window.location=\"/"+$(this).attr("ows_FileRef").split(";#")[1]+"\"'>"+$(this).attr("ows_LinkFilename")+"</td></tr>")}})}})}}function G(){$().SPCOMServices({operation:"GetList",listName:F.title,async:true,completefunc:function(J,I){$(J.responseXML).find("Field").each(function(){if(b($(this).attr("ID"))!==""&&b($(this).attr("ID"))!==undefined){F.fields[b($(this).attr("ID"))]=new D(this)}})}})}this.type="";switch($(H).attr("ServerTemplate")){case ("100"):this.type="Lists";break;case ("101"):this.type="Document Libraries";break;case ("109"):this.type="Picture Libraries";break;case ("108"):this.type="Discussion Boards";break;case ("102"):this.type="Surveys";break}this.title=$(H).attr("Title");this.desc=$(H).attr("Description");this.itemCount=$(H).attr("ItemCount");this.url=$(H).attr("DefaultViewUrl");this.id=$(H).attr("ID");this.safeId=b(this.id);this.name=$(H).attr("Name");this.excel=this.url+"?ShowInGrid=True&View=";this.fields=new Array();this.settings=u+"/_layouts/listedit.aspx?List="+encodeURIComponent(this.name);var F=this;G();E();return this};function f(D){return D.replace(/[^a-zA-Z0-9]+/g,"")}function i(E){if(E!="Nav"){var G=new Array();for(var H in m.lists){if(m.lists[H].type==E){G.push(m.lists[H])}}var F="<div class='SPCOM-menu-container'><table id='SPCOMitem"+b(E)+"' class='SPCOM-menu-item'>";var D="";$(G).each(function(){D+="<tr><td onclick='SPCOM.site.lists[\""+b(this.id)+"\"].moreInfo()'>"+this.title+"</td><td onclick='window.location=\""+this.url+"\";'>&gt;</td></tr>"});if(D===""){D="<tr><td colspan='2'>No Items Found</td></tr>"}F+=D+"</table></div>";return F}else{return"<div class='SPCOM-menu-container'><table id='SPCOMitemNav' class='SPCOM-menu-item'><tr><td><a href='"+m.allSite+"'>All Site Content</a></td></tr><tr><td><a href='"+m.main+"'>Default</a></table></div>"}}function t(D){$("#SPCOMlistInfo"+D).show()}function l(D){$("#SPCOMlistInfo"+D).hide()}var B=["Nav","Lists","Document Libraries","Surveys","Subsites"];function k(D){$("#SPCOMlistInfo"+D+" .SPCOM-listInfo-field-detail").show()}function p(D){$("#SPCOMlistInfo"+D+" .SPCOM-listInfo-field-detail").hide()}function g(){return $(location).attr("href")}function r(){$(".SPCOMProp").detach();$(".SPCOMProp").die();SPCOM=undefined}function e(D){while(D.indexOf(" ")>-1){D=D.replace(" ","")}return D}function n(D){D=f(D);$("#SPCOM-menu-"+D).addClass("SPCOM-shaded");$("#SPCOMitem"+D).parent().show()}function A(D){D=f(D);$("#SPCOM-menu-"+D).removeClass("SPCOM-shaded");$("#SPCOMitem"+D).parent().hide()}function h(){$("body").append("<link type='text/css' rel='stylesheet' href='"+y+"' />")}function w(){$(B).each(function(){$("#SPCOM-menu-row").append("<td class='SPCOM-menu-td' id='SPCOM-menu-"+b(this)+"' onmouseout='SPCOM.hideMenu(\""+b(this)+"\")' onmouseover='SPCOM.showMenu(\""+b(this)+"\")'><div>"+this+"</div>"+i(this)+"</td>")});$(".SPCOM-menu-item tr").hover(function(){$(this).addClass("SPCOM-shaded")},function(){$(this).removeClass("SPCOM-shaded")});setTimeout(function(){$(".SPCOM-menu-item tr").hover(function(){$(this).addClass("SPCOM-shaded")},function(){$(this).removeClass("SPCOM-shaded")})},1000)}function j(D){return{title:$(D).attr("Title"),itemCount:$(D).attr("ItemCount"),url:$(D).attr("DefaultViewUrl"),id:$(D).attr("ID"),name:$(D).attr("Name")}}function s(){$("body").prepend("<div id='SPCommander' class='SPCOMProp'><div><table id='SPCOM-menu'><tr id='SPCOM-menu-row'><td class='SPCOM-menu-td'><img src='http://joshrouwhorst.com/sp/imgs/spcom.png' /></td></tr></table></div><script type='text/javascript'>setTimeout(SPCOM.buildBar, 500);<\/script></div>")}var m=(function(){var E,I,H,G,F,D=new Array();$().SPCOMServices({operation:"GetListCollection",async:false,completefunc:function(K,J){$(K.responseXML).find("List").each(function(){var L=new d(this);D[b(L.id)]=L})}});G=$().SPCOMServices.SPGetCurrentSite();F=G+"/_layouts/viewlsts.aspx";E=G+"/default.aspx";return{lists:D,rootPath:G,allSite:F,main:E}}());h();$().SPCOMServices.defaults.webUrl=$().SPCOMServices.SPGetCurrentSite();v.build();return{shade:C,unshade:z,info:v,site:m,showField:k,hideField:p,showListInfo:t,hideListInfo:l,buildBar:w,hideMenu:A,showMenu:n,exit:r,init:s}}());SPCOM.init()},1)}}catch(a){setTimeout(SPCOM_JQUERY_WAIT,100)}}SPCOM_JQUERY_WAIT();